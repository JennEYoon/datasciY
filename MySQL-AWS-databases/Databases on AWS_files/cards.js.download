(function(){define("directories/directories-utils/validation-utils",[],function(){var ValidationUtils={isAbsoluteUrl:function(url){var re=new RegExp(/^https?:\/\//i);return re.test(url)}};return ValidationUtils});define("directories/directories-utils/data-utils",["directories/directories-utils/validation-utils","librastandardlib/logger/logger"],function(ValidationUtils,Logger){var logger=new Logger("Directories");var DataUtils={removeEmptyString:function(objArr){var newArr=objArr.map(function(obj){var fields=obj.additionalFields||obj.item.additionalFields;if(fields){fields=Object.keys(fields).reduce(function(additionalFields,key){additionalFields[key.trim()]=fields[key];return additionalFields},{});if(obj.additionalFields){obj.additionalFields=fields}else{obj.item.additionalFields=fields}}return obj});return newArr},strToBool:function(value){switch(value){case"1":return true;case"0":return false;default:return false}},splitJSONByFieldValue:function(fldName,fldVals,items){var splitData={};items.forEach(function(item){var fldVal=item.additionalFields[fldName];if(fldVals[fldVal]){splitData[fldVal]=splitData[fldVal]||[];splitData[fldVal].push(item)}});return splitData},removeItemWithInvalidUrl:function(items,idx,url){if(!ValidationUtils.isAbsoluteUrl(url)){items.splice(idx,1)}return items},mapAdditionalFields:function(item,fields,fieldTypes){var additionalFields=item.additionalFields;var mappedFields={};Object.keys(fields).forEach(function(key){var fldValue=this.getFieldValue(additionalFields,fields[key].trim(),fieldTypes);mappedFields[key]=fldValue!==undefined?fldValue:""}.bind(this));Object.keys(additionalFields).forEach(function(key){if(!mappedFields.hasOwnProperty(key)){var fldVal=this.getFieldValue(additionalFields,key,fieldTypes);if(fldVal!==undefined){mappedFields[key]=fldVal}}}.bind(this));return mappedFields},fieldTypeMap:{LongText:function(_fldValue){return{type:"LongText",value:_fldValue}},Boolean:function(_fldValue){return DataUtils.strToBool(_fldValue)},Asset:function(_fldValue){try{var assetObj=JSON.parse(_fldValue);var publicUrl=assetObj.publicUrl;if(!publicUrl){throw new Error("publicUrl is not found: "+_fldValue)}if(publicUrl.indexOf("https://")===0){return publicUrl}return"https://"+publicUrl}catch(e){logger.debug("JSON parsing error: "+e.message+", "+_fldValue);return""}}},getFieldValue:function(additionalFields,fldName,fieldTypes){if(fldName===""||!additionalFields.hasOwnProperty(fldName)){return}var fldValue=additionalFields[fldName];if(fieldTypes===undefined||!fieldTypes.hasOwnProperty(fldName)){return fldValue}var fldType=fieldTypes[fldName];if(this.fieldTypeMap[fldType]===undefined){return fldValue}return this.fieldTypeMap[fldType](fldValue)}};return DataUtils});define("libra-cardsui/utils/cards-utils",["directories/directories-utils/data-utils"],function(DataUtils){var CardsUtils={numOfCompsAvailable:function(comp,cardsId){if(!Libra.Comp.registry.hasOwnProperty(comp)){return 0}var components=Libra.Comp.registry[comp].elem||[];var numOfComps=0;for(var i=0;i<components.length;i++){var elem=components[i];var data=$(elem).data();var uiScope=data.uiScope||data.filterScope;if(uiScope&&uiScope===cardsId){numOfComps++}}return numOfComps},numOfEventsPublished:function(evt){if(!Libra.EventHub.publishQueue.hasOwnProperty(evt)){return 0}var events=Libra.EventHub.publishQueue[evt]||[];return events.length},mapFields:function(data,fieldsData){fieldsData=fieldsData||{};var requiredFields=fieldsData.requiredFields||{};var optionalFields=fieldsData.optionalFields||{};var dialogFields=fieldsData.dialogFields||{};var items=data.items||[];var fields=$.extend({},requiredFields,optionalFields);if(!$.isEmptyObject(fields)||!$.isEmptyObject(dialogFields)){for(var i=0;i<items.length;i++){var item=items[i];if(items[i].item){item=items[i].item;items[i].id=items[i].item.id}items[i].mappedFields=DataUtils.mapAdditionalFields(item,fields,data.fieldTypes);for(var field in dialogFields){if(dialogFields.hasOwnProperty(field)&&dialogFields[field]!==""){items[i].mappedFields[field]=dialogFields[field]}}}}return items},toggleElementClass:function(condition,$elem,className){$elem.toggleClass(className,condition)}};return CardsUtils});define("librastandardlib/url-utils/getQueryStringParam",[],function(){"use strict";return function getQueryStringParam(name,querySrting){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var re=new RegExp("[\\?&]"+name+"=([^&#]*)");var res=re.exec(querySrting);if(res===null){return""}return decodeURIComponent(res[1].replace(/\+/g," "))}});define("librastandardlib/url-utils/updateQueryStringParam",[],function(){"use strict";return function updateQueryStringParam(str,key,value){key=encodeURIComponent(key)||"";value=encodeURIComponent(value)||"";var newParam=key+"="+value;var params="?"+newParam;if(str){var updateRegex=new RegExp("([?&])"+key+"=([^&#]*)");var removeRegex=new RegExp("([?&])"+key+"=[^&#]+[&#]?");if(value===""){params=str.replace(removeRegex,"$1");params=params.replace(/[&?]$/,"")}else if(str.match(updateRegex)!==null){params=str.replace(updateRegex,"$1"+newParam)}else{params=str+"&"+newParam}}else if(value===""){return""}return params}});define("librastandardlib/obj-utils/assign",[],function(){return function assign(target,args){"use strict";if(target===null){throw new TypeError("Cannot convert undefined or null to object")}var to=Object(target);for(var i=1;i<arguments.length;i++){var source=arguments[i];if(source!==null){for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){to[key]=source[key]}}}}return to}});define("librastandardlib/dom-utils/smoothScroll",["librastandardlib/obj-utils/assign"],function(_assign){"use strict";var defaults={targetTop:0,duration:400,callback:null};var smoothScroll=function(options){options=_assign({},defaults,options);$("html, body").stop().animate({scrollTop:options.targetTop},options.duration,function(){if(options.callback!==null){options.callback()}})};return smoothScroll});define("librastandardlib/dom-utils/smoothScrollToElem",["librastandardlib/dom-utils/smoothScroll","librastandardlib/obj-utils/assign"],function(smoothScroll,_assign){"use strict";var defaults={scrollPadding:0,duration:400,headerSelector:null,callback:null};var smoothScrollToElem=function(elem,options){options=_assign({},defaults,options);if(elem){var fixedHeaderOffset=0;var header=document.querySelector(options.headerSelector);if(header!==null&&getComputedStyle(header).position==="fixed"){fixedHeaderOffset=header.clientHeight}smoothScroll({targetTop:$(elem).offset().top-(fixedHeaderOffset+options.scrollPadding),duration:options.duration,callback:options.callback})}};return smoothScrollToElem});define("libra/dom-utils/transition",[],function(){return{Speed:{effectsDefault:200,scrollDefault:400,fast:200},Timing:{effectsDefault:"ease-in-out"}}});define("libra/dom-utils/smoothScrollOptions",["libra/dom-utils/transition"],function(Transition){"use strict";return{scrollPadding:30,duration:Transition.Speed.scrollDefault,headerSelector:"#aws-page-header",parentSelector:"#aws-page-content",callback:function(){}}});define("libra-cardsui/components/pagination",["librastandardlib/logger/logger","libra-cardsui/utils/cards-utils","librastandardlib/url-utils/getQueryStringParam","librastandardlib/url-utils/updateQueryStringParam","librastandardlib/dom-utils/smoothScrollToElem","libra/dom-utils/smoothScrollOptions"],function(Logger,CardsUtils,getQueryStringParam,updateQueryStringParam,smoothScrollToElem,smoothScrollOptions){var logger=new Logger("Directories");var defaults={currentPage:1,cardNumbersSelector:".m-card-numbers",ellipsesBeforeSelector:".m-ellipses-before",ellipsesAfterSelector:".m-ellipses-after",firstPageSelector:".m-first-page",iconLeftSelector:".m-icon-angle-left",iconRightSelector:".m-icon-angle-right",lastPageSelector:".m-last-page",moreSelector:".m-directories-more",pageLinkSelector:".m-page-link",pageNumGroupSelector:".m-page-num-group",pageNumbersWrapperSelector:".m-cards-page-numbers",clickEvent:"click.pagination",paginationEvent:"awsm_pagination_clicked",pageUrlParamKey:"awsm.page",currentPageClass:"m-current-page",pageLinkClass:"m-page-link"};function Pagination(elem,options){this.$elem=$(elem);this.options=$.extend(true,{},defaults,options);this.$pageNumbersWrapper=this.$elem.find(this.options.pageNumbersWrapperSelector);this.$moreButton=this.$elem.find(this.options.moreSelector)}Pagination.prototype={init:function(){this.paginationInit=true;this.resetPageNum=true;this.$pageLinks=this.$elem.find(this.options.pageLinkSelector);this.$firstPage=this.$elem.find(this.options.firstPageSelector);this.$lastPageLink=this.$elem.find(this.options.lastPageSelector);this.$angleLeft=this.$elem.find(this.options.iconLeftSelector);this.$angleRight=this.$elem.find(this.options.iconRightSelector);this.$ellipsesBefore=this.$elem.find(this.options.ellipsesBeforeSelector);this.$ellipsesAfter=this.$elem.find(this.options.ellipsesAfterSelector);this.$pageNumGroup=this.$elem.find(this.options.pageNumGroupSelector);this.$cardNumbers=this.$elem.find(this.options.cardNumbersSelector)},getPageNumFromQS:function(){var pageNum="";if(this.$pageNumbersWrapper.length>0){pageNum=getQueryStringParam(this.options.pageUrlParamKey+"-"+this.options.cardsId,location.search)}return pageNum},handlePagination:function(metadata,params,resetPageNum){logger.debug("API metadata",metadata);logger.debug("Directories params",params);if(!metadata||!params.hasOwnProperty("size")){logger.debug("Pagination not enabled");return}this.params=params||{};this.showCardNumbers=false;this.pageNumbers=false;this.moreButton=false;this.size=params.size;this.totalHits=metadata.totalHits;this.count=metadata.count;this.numOfPages=Math.ceil(this.totalHits/this.size);var pageQSValue=this.getPageNumFromQS();if(resetPageNum){this.options.currentPage=1;if(this.$pageNumbersWrapper.length>0&&this.numOfPages>0&&pageQSValue!==""){this.appendQueryString(this.options.currentPage)}}if(this.$pageNumbersWrapper.length>0){CardsUtils.toggleElementClass(this.numOfPages>1,this.$pageNumbersWrapper,this.options.activeClass);if(this.$cardNumbers.length>0){this.showCardNumbers=true;this.displayCardNumbers()}if(this.numOfPages>1){this.pageNumbers=true;this.$lastPageLink[0].textContent=this.numOfPages}else{if(pageQSValue!==""){var pageNum=parseInt(pageQSValue,10);if(pageNum>this.numOfPages&&!resetPageNum){this.resetToFirstPage()}}else{this.appendQueryString("")}}}else if(this.$moreButton.length>0){if(this.numOfPages>1){this.moreButton=true}else{this.$moreButton.removeClass(this.options.activeClass)}}},resetToFirstPage:function(){this.options.currentPage=1;this.appendQueryString(this.options.currentPage);this.params["page"]=this.options.currentPage-1;this.$elem.trigger(this.options.paginationEvent,[this.params])},displayCardNumbers:function(){var startNum=(this.options.currentPage-1)*this.size+1;var endNum=Math.min(startNum+this.size-1,this.totalHits);var cardNumbers=startNum;if(startNum!==endNum){cardNumbers+="-"+endNum}if(this.totalHits>0){this.$cardNumbers.html(cardNumbers+" ("+this.totalHits+")")}else{this.$cardNumbers.html("")}},handlePageNumbers:function(){var pageQSValue=this.getPageNumFromQS();this.options.currentPage=pageQSValue!==""?parseInt(pageQSValue,10):this.options.currentPage;if(this.options.currentPage>this.numOfPages){this.resetToFirstPage()}this.resetPageNum=true;this.displayPageNumbers();CardsUtils.toggleElementClass(this.options.currentPage>1,this.$angleLeft,this.options.activeClass);CardsUtils.toggleElementClass(this.options.currentPage<this.numOfPages,this.$angleRight,this.options.activeClass);this.setCurrentPageClass();this.bindPaginationEvents();if(this.showCardNumbers){this.displayCardNumbers()}},displayPageNumbers:function(){var minPage=this.options.currentPage<=4?2:this.options.currentPage-2;var maxPage=this.options.currentPage<=4?6:this.options.currentPage+2;if(this.numOfPages-this.options.currentPage<=4&&this.numOfPages>6){minPage=this.numOfPages-5}if(this.numOfPages-this.options.currentPage<=4){maxPage=this.numOfPages}if(this.numOfPages<=6){minPage=2}if(this.options.lastPageNum){this.handleLastPageNum(maxPage)}this.removeAll();CardsUtils.toggleElementClass(maxPage<this.numOfPages-1,this.$ellipsesAfter,this.options.activeClass);CardsUtils.toggleElementClass(minPage>2,this.$ellipsesBefore,this.options.activeClass);for(var i=minPage;i<=maxPage;i++){$(this.createPageNumElem(i)).appendTo(this.$pageNumGroup)}},handleLastPageNum:function(maxPage){CardsUtils.toggleElementClass(this.numOfPages-this.options.currentPage>4&&this.numOfPages>6,this.$lastPageLink,this.options.activeClass)},removeAll:function(){this.$pageNumGroup.empty()},createPageNumElem:function(pageNum){var pageLink=document.createElement("a");pageLink.className=this.options.pageLinkClass;pageLink.setAttribute("data-mbox-ignore",true);var qsParam="?"+this.options.pageUrlParamKey+"="+pageNum;pageLink.setAttribute("href",location.origin+location.pathname+qsParam);var linkText=document.createTextNode(pageNum);pageLink.appendChild(linkText);return pageLink},setCurrentPageClass:function(){this.$lastPageLink.removeClass(this.options.currentPageClass);if(this.options.currentPage===1){this.$firstPage.addClass(this.options.currentPageClass)}else{var $pageLinks=this.$elem.find(this.options.pageLinkSelector);for(var i=0;i<$pageLinks.length;i++){var $pageLink=$pageLinks[i];var linkText=parseInt($($pageLink).text(),10);if(linkText===this.options.currentPage){this.$firstPage.removeClass(this.options.currentPageClass);$($pageLink).addClass(this.options.currentPageClass)}}}},bindPaginationEvents:function(){this.handleClickEvent(this.$elem.find(this.options.pageLinkSelector));this.handleClickEvent(this.$elem.find(this.options.iconLeftSelector),this.options.currentPage-1);this.handleClickEvent(this.$elem.find(this.options.iconRightSelector),this.options.currentPage+1)},appendQueryString:function(currentPage){var qsParam=updateQueryStringParam(location.search,this.options.pageUrlParamKey+"-"+this.options.cardsId,currentPage);window.history.replaceState("","",qsParam)},handleMoreButton:function(){this.resetPageNum=true;if(this.options.currentPage<this.numOfPages){this.handleClickEvent(this.$moreButton,this.options.currentPage+1);this.$moreButton.addClass(this.options.activeClass)}else{logger.debug("No more data to load");this.$moreButton.removeClass(this.options.activeClass)}},handleClickEvent:function($elem,pageNum){$elem.off(this.options.clickEvent);$elem.on(this.options.clickEvent,function(e){e.preventDefault();this.resetPageNum=false;this.options.currentPage=pageNum||$(e.target).text();if(this.pageNumbers){this.appendQueryString(this.options.currentPage);smoothScrollToElem($(e.target).closest(this.options.itemsConfig.selector),smoothScrollOptions)}var pageNumParam={page:this.options.currentPage-1};this.params["page"]=this.options.currentPage-1;logger.debug("Request to load data from ",pageNumParam);this.$elem.trigger(this.options.paginationEvent,[this.params])}.bind(this))}};return Pagination});define("librastandardlib/obj-utils/mixin",[],function(){"use strict";return function mixin(target,source){if(typeof target!=="object"||typeof source!=="object"){return target}Object.keys(source).forEach(function(key){if(!target.hasOwnProperty(key)){target[key]=source[key]}});return target}});define("librastandardlib/test-helpers/browser-globals/window",[],function(){return window});define("libra/tracking-utils/tracking-mixin",["librastandardlib/url-utils/getQueryStringParam","librastandardlib/url-utils/updateQueryStringParam","librastandardlib/test-helpers/browser-globals/window"],function(getQueryStringParam,updateQueryStringParam,window){"use strict";var TrackingMixin={init:function(){this.queryString=window.location.search.toLowerCase();this.addTracking()},getTrackingObject:function(attrData){try{return JSON.parse(attrData)}catch(err){return null}},updateHref:function(href,obj,allowOverride){if(!obj||!href||href==="#"){return href}var deepLink="";var deepLinkIndex=href.indexOf("#");if(deepLinkIndex>-1){deepLink=href.substring(deepLinkIndex);href=href.substring(0,deepLinkIndex)}Object.keys(obj).forEach(function(key){if(getQueryStringParam(key.toLowerCase(),href.toLowerCase()).length===0&&obj[key]){href+=(href.match(/\?/)?"&":"?")+encodeURIComponent(key)+"="+encodeURIComponent(obj[key])}else if(allowOverride&&obj[key]){href=updateQueryStringParam(href,key,obj[key])}});if(deepLink){href+=deepLink}return href}};return TrackingMixin});define("librastandardlib/url-utils/getCurrentDomainParts",["librastandardlib/test-helpers/browser-globals/window"],function(window){"use strict";return function getCurrentDomainParts(num){if(typeof num==="undefined"){return window.location.hostname}var parts=window.location.hostname.split(".");while(parts.length>num){parts.shift()}return parts.join(".")}});define("librastandardlib/test-helpers/browser-globals/document",[],function(){return document});define("librastandardlib/cookie-utils/tiny-cookie",["librastandardlib/url-utils/getCurrentDomainParts","librastandardlib/test-helpers/browser-globals/document","librastandardlib/obj-utils/assign"],function(getCurrentDomainParts,document,_assign){"use strict";var defaults={expires:3600,path:"/",secure:true,domain:getCurrentDomainParts()};var regReserved=/^(?:expires|max-age|path|domain|secure)$/i;var ERR_RESERVED_WORD="Name cannot contain reserved cookie property names.";var regSpecial=/[.*+?^${}()|[\]\\]/g;function set(name,val,opts){opts=_assign({},defaults,opts);var d=new Date;d.setTime(d.getTime()+opts.expires*1e3);var exp=d.toUTCString();if(typeof opts.cb==="function"){val=opts.cb(val)}document.cookie=name+"="+val+";expires="+exp+";domain="+opts.domain+";path="+opts.path+(opts.secure?";secure":"")}function get(name,cb){var val=document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+name.replace(regSpecial,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")||null;if(typeof cb==="function"){return cb(val)}return val}function remove(name,opts){if(!name){return false}if(regReserved.test(name)){throw new Error(ERR_RESERVED_WORD)}opts=_assign({},defaults,opts);document.cookie=name+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;domain="+opts.domain+";path="+opts.path}function api(){if(arguments.length===0||!arguments[0]){return false}if(regReserved.test(arguments[0])){throw new Error(ERR_RESERVED_WORD)}if(arguments.length===1||typeof arguments[1]==="function"||typeof arguments[1]==="undefined"){return get.apply(this,arguments)}return set.apply(this,arguments)}api.remove=remove;return api});define("librastandardlib/cookie-utils/cookie",["librastandardlib/cookie-utils/tiny-cookie"],function(tinyCookie){"use strict";function set(name,val,opts){if(typeof val==="object"){val=JSON.stringify(val)}tinyCookie(encodeURIComponent(name),encodeURIComponent(val),opts)}function get(name,cb){var v=tinyCookie(encodeURIComponent(name),cb);if(v){v=decodeURIComponent(v);try{return JSON.parse(v)}catch(e){return v}}return null}function remove(name,opts){if(!name){return false}return tinyCookie.remove(encodeURIComponent(name),opts)}function api(){if(arguments.length===0){return false}if(arguments.length===1||typeof arguments[1]==="function"||typeof arguments[1]==="undefined"){return get.apply(this,arguments)}set.apply(this,arguments)}api.remove=remove;return api});define("libra/tracking-utils/trk-cookie",["librastandardlib/cookie-utils/cookie"],function(cookie){"use strict";var COOKIE_NAME="aws_campaign_trk";var COOKIE_DURATION=7200;var TrkCookie={set:function(qsTrkCampaign,qsTrk){if(qsTrk.length===0){return false}var campaignCookie=cookie(COOKIE_NAME)||{};campaignCookie.campaign=qsTrkCampaign;campaignCookie.trk=qsTrk;cookie(COOKIE_NAME,JSON.stringify(campaignCookie),{expires:COOKIE_DURATION})},get:function(){return cookie(COOKIE_NAME)}};return TrkCookie});define("libra/tracking-utils/trk-tracking",["librastandardlib/obj-utils/mixin","libra/tracking-utils/tracking-mixin","libra/tracking-utils/trk-cookie","librastandardlib/url-utils/getQueryStringParam"],function(mixin,TrackingMixin,trkCookie,getQueryStringParam){"use strict";var TRK_CAMPAIGN="trkcampaign";var TRK="trk";var DEFAULT_OUTPUT_KEY="refid";var PREV_TRK_ELEM={selector:"a[data-aws-params]",attrName:"awsParams"};var TRK_ELEM={selector:"a[data-trk-params]",attrName:"trkParams"};var ALL_TRK_ELEMS=[TRK_ELEM,PREV_TRK_ELEM];var TrkTracking=function(){this.init()};TrkTracking.prototype={addTracking:function(){var qsTrkCampaign=getQueryStringParam(TRK_CAMPAIGN,this.queryString);var qsTrk=getQueryStringParam(TRK,this.queryString);if(qsTrkCampaign.length===0){qsTrkCampaign=this.getExistingCampaign()}trkCookie.set(qsTrkCampaign,qsTrk);var campaignCookie=trkCookie.get();if(!qsTrk&&!campaignCookie){return}ALL_TRK_ELEMS.forEach(function(trk){var elems=document.querySelectorAll(trk.selector);for(var i=0;i<elems.length;i++){var elem=elems[i];var elemDataObj=this.getTrackingObject(elem.dataset[trk.attrName]);var campaign=elemDataObj.trkCampaign?elemDataObj.trkCampaign.toLowerCase():"";var allowOverride=elemDataObj.trkOverrideWithQs;if(!campaign||campaignCookie&&campaign===campaignCookie.campaign){var val=qsTrk||campaignCookie.trk;if(val){var outputParam=elemDataObj.trkOutputParam||DEFAULT_OUTPUT_KEY;var obj={};obj[outputParam]=val;obj[TRK_CAMPAIGN]=qsTrkCampaign;elem.setAttribute("href",this.updateHref(elem.getAttribute("href"),obj,allowOverride));$(elem).on("click",function(){trkCookie.set(qsTrkCampaign,val)})}}}}.bind(this))},getExistingCampaign:function(){var campaignCookie=trkCookie.get();if(campaignCookie&&campaignCookie.campaign){return campaignCookie.campaign}return""}};mixin(TrkTracking.prototype,TrackingMixin);Libra.Comp.register({name:"trk-tracking",initFct:function(){new TrkTracking},initTime:"immediate",selfRequire:true});return TrkTracking});define("libra/components/cards",["directories/directories-bundle","libra-cardsui/utils/cards-utils","libra-cardsui/components/pagination","librastandardlib/obj-utils/mixin","librastandardlib/logger/logger","libra/event-utils/event-hub","libra/tracking-utils/trk-tracking","require"],function(DirectoriesBundle,CardsUtils,Pagination,mixin,Logger,EventHub,TrkTracking,require){var logger=new Logger("Cards");var options={componentName:"Cards",noItemsSelector:".m-cards-no-items",activeClass:"m-active",cardSelector:".m-card",itemsConfig:{selector:".lb-directory-cards"}};function Cards(elem){logger.debug("Cards instantiated");this.$elem=$(elem);this.init(options);if(this.template){this.options.cardsId=this.options.cardsId||this.directoryId;this.pagination=new Pagination(elem,this.options);this.initCards();this.$elem.on(this.pagination.options.paginationEvent,function(e,param){this.loadData(param)}.bind(this))}}Cards.prototype={initCards:function(){logger.debug("DirectoryCards initiated");this.noItems=this.$elem.find(this.options.noItemsSelector)[0];if(this.options.themeJs!==undefined){this.loadCardsUI()}else{this.loadCardsData()}},processData:function(data,replaceContent,params){var themeConfig=this.data.themeConfig;if(themeConfig!==undefined){data.items=CardsUtils.mapFields(data,themeConfig.mappings)}logger.debug("Cleaned data",data);if(!this.pagination.paginationInit&&this.pagination.$pageNumbersWrapper.length>0){this.pagination.init()}if(!this.pagination.resetPageNum){this.resetPageNum=false}this.pagination.handlePagination(data.metadata,params,this.resetPageNum);if(this.pagination.pageNumbers){replaceContent=true;this.pagination.handlePageNumbers()}else if(this.pagination.moreButton){this.pagination.handleMoreButton()}if(this.noItems!==null&&data.hasOwnProperty("items")){CardsUtils.toggleElementClass(data.items.length===0,$(this.noItems),this.options.activeClass)}this.displayItems(data,replaceContent);this.addTrkTrackingToLinks();new TrkTracking},loadCardsUI:function(){var that=this;var themeName=this.options.themeConfig.themeName;require([this.options.themeJs],function(ThemeUI){logger.debug("Theme for "+themeName+" is loaded");new ThemeUI(that.$elem,that.options.itemsConfig);that.loadCardsData()})},loadCardsData:function(){var param={};var pageNum=this.pagination.getPageNumFromQS();if(pageNum!==""&&parseInt(pageNum,10)>=1){param["page"]=pageNum-1}this.initController(this.options,param)},addTrkTrackingToLinks:function(){this.$elem.find(this.options.cardSelector).each(function(){var param={};param.trkOutputParam=$(this).data("trkOutputParam");param.trkCampaign=$(this).data("trkCampaign");if(!param.trkOutputParam&&!param.trkCampaign){return}param.trkOverrideWithQs=$(this).data("trkOverrideWithQs");$(this).find('a:not(".m-share-link")').each(function(){$(this).attr("data-trk-params",JSON.stringify(param))})})}};mixin(Cards.prototype,DirectoriesBundle.DirectoriesMixin);mixin(Cards.prototype,DirectoriesBundle.DirectoriesCardsController);Libra.Comp.register({name:"cards",initFct:function(elem){new Cards(elem)},initTime:"immediate"});return Cards})})();