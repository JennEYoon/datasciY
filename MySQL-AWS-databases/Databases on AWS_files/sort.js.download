define(["directories/configurations/event-config","libraui/components/dropdown","libra/event-utils/event-hub"],function(EventConfig,Dropdown,EventHub){var defaults={dropdownSelector:".lb-dropdown",dropdownItemSelector:".lb-dropdown-item",activeClassSelector:".lb-active",events:EventConfig};function Sort(elem){this.options=$.extend({},defaults);this.options.inputChangeEvent=this.options.events.update;this.$elem=$(elem);this.$dropdownElem=this.$elem.find(this.options.dropdownSelector);this.initialLoad=true;this.sortData=this.$elem.data();this.sortParams={};this.uiScope=this.sortData.uiScope;this.init(this.options)}Sort.prototype={init:function(){this.dropdown=new Dropdown(this.$dropdownElem,this.options);EventHub.subscribe(this.options.events.setDefaultFromQS+"-"+this.uiScope,{cb:function(evt,data){if(data===undefined){return}var eventData=typeof data==="object"?data:JSON.parse(data);if(eventData.hasOwnProperty("sortParams")&&eventData.sortParams.sortOrder&&eventData.sortParams.sortBy){this.sortOrder=eventData.sortParams.sortOrder;this.sortBy=eventData.sortParams.sortBy}}.bind(this)});EventHub.subscribe(this.options.events.dataReady+"-"+this.uiScope,{cb:function(){if(this.sortBy&&this.sortOrder){this.dropdown.select(this.sortBy+"-"+this.sortOrder);if(this.sortBy){this.sortParams.sort_by=this.sortBy;this.sortParams.sort_order=this.sortOrder}}this.triggerSortEvent()}.bind(this)});this.bindInputChangeEvent()},triggerSortEvent:function(){if(!this.initialLoad){this.$activeDropdownItem=this.$elem.find(this.options.dropdownItemSelector+this.options.activeClassSelector);this.sortParams.sort_by=this.$activeDropdownItem.data("sortBy");this.sortParams.sort_order=this.$activeDropdownItem.data("sortOrder");this.sortParams.value=this.$activeDropdownItem.data("value")}if(this.initialLoad){if(!(this.sortOrder&&this.sortBy)){this.sortParams.sort_by=this.$elem.find(this.options.dropdownItemSelector).first().data("sortBy");this.sortParams.sort_order=this.$elem.find(this.options.dropdownItemSelector).first().data("sortOrder")}EventHub.publish(this.options.events.initialLoad+"-"+this.uiScope,this.getEventData(this.sortParams));this.initialLoad=false}else{EventHub.publish(this.options.events.update+"-"+this.uiScope,this.getEventData(this.sortParams))}},getEventData:function(params){return{sort_by:params.sort_by,sort_order:params.sort_order,trackData:{component:"Sort",item:params.sort_by+"-"+params.sort_order}}},bindInputChangeEvent:function(){var that=this;this.dropdown.$elem.on(that.options.inputChangeEvent,function(){that.triggerSortEvent()})}};Libra.Comp.register({name:"sort",initFct:function(elem){new Sort(elem)},initTime:"immediate"});return Sort});